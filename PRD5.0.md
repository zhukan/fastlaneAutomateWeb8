# PRD 5.0 - 下架监控关联对比功能

**版本**: 5.0  
**创建日期**: 2025-12-25  
**状态**: 需求完结
**负责人**: 待定  

---

## 📋 文档说明

本文档记录**下架监控关联对比功能**的需求讨论过程，暂不包含技术实现细节。

---

## 🎯 需求背景

### 现状
目前系统有两个独立的监控功能：
1. **下架监控**（App Removal Monitor）- 监控自己的正式包
2. **目标包监控**（Target App Monitor）- 监控竞品包

这两个功能是**完全独立**的，无法看到自己的包和竞品包之间的对比关系。

### 痛点
- 需要在两个页面之间切换才能对比自己的包和竞品的状态
- 无法直观看到"我的包 vs 竞品包"的状态对比
- 缺少快速跳转到竞品分析工具（关键词查询、七麦等）的入口

### 目标
将"下架监控"页面升级为**关联对比视图**，实现：
- 一行显示一个"我的包"和对应的"目标包"
- 快速对比两者的状态
- 提供快捷操作入口

---

## 🎨 界面设计

### 整体布局

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  下架监控 - 我的包 vs 目标包对比                                                          │
│  实时对比自己的包与竞品目标包的状态                                                        │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│  统计面板                                                                                  │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┬──────────┐                   │
│  │ 我的包总数 │ 我的包在架│ 我的包下架│ 已关联数  │ 目标包在架│ 目标包下架│                   │
│  │    48     │    45    │     3    │    32    │    28    │     4    │                   │
│  └──────────┴──────────┴──────────┴──────────┴──────────┴──────────┘                   │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│  操作工具栏                                                                                │
│  [🔄 同步我的包] [🔄 同步目标包] [🔍 批量检查] [🔗 批量关联管理]                          │
│  [搜索框: 搜索我的包或目标包...] [状态: 全部 ▼] [显示: 全部/仅已关联/仅未关联 ▼]           │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│  对比列表（表格形式）                                                                      │
│                                                                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐│
│  │ 我的包           │今日新增│昨日新增│包状态│ 目标包          │备注│目标包状态│ 操作    │││
│  ├─────────────────────────────────────────────────────────────────────────────────────┤│
│  │ 奇智AI写作助手   │  +15  │  +23  │✅在架│ 完美抄抄君      │主竞│❌下架   │[关键词] │││
│  │ com.qizhi.writer│       │       │ 5分前│ ID: 6756691631 │品  │12-20   │[刷新]   │││
│  │ 账号: 账号A      │       │       │      │                │    │        │[解除]   │││
│  ├─────────────────────────────────────────────────────────────────────────────────────┤│
│  │ 智能翻译助手     │   +8  │  +12  │✅在架│ AI Translator  │观察│✅在架   │[关键词] │││
│  │ com.qizhi.trans │       │       │10分前│ ID: 1234567890 │对象│监控中   │[刷新]   │││
│  │ 账号: 账号B      │       │       │      │                │    │        │[解除]   │││
│  ├─────────────────────────────────────────────────────────────────────────────────────┤│
│  │ 创意文案生成器   │  +32  │  +28  │✅在架│ [未关联]        │-   │  -     │[关联]   │││
│  │ com.qizhi.copy  │       │       │ 2分前│                │    │        │[刷新]   │││
│  │ 账号: 账号A      │       │       │      │                │    │        │         │││
│  ├─────────────────────────────────────────────────────────────────────────────────────┤│
│  │ 智能问答助手     │  +18  │  +15  │❌下架│ Smart QA       │竞品│⚪未知   │[关键词] │││
│  │ com.qizhi.qa    │       │       │12-22 │ ID: 0987654321 │    │API超时  │[刷新]   │││
│  │ 账号: 账号C      │       │       │      │                │    │        │[解除]   │││
│  ├─────────────────────────────────────────────────────────────────────────────────────┤│
│  │ 语音转文字工具   │   +5  │   +7  │✅在架│ [未关联]        │-   │  -     │[关联]   │││
│  │ com.qizhi.voice │       │       │ 8分前│                │    │        │[刷新]   │││
│  │ 账号: 账号B      │       │       │      │                │    │        │         │││
│  └─────────────────────────────────────────────────────────────────────────────────────┘│
│                                                                                           │
│  [显示 1-5 / 共 48 个]                                              [上一页] [下一页]     │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 表格列说明

| 列名 | 说明 | 数据来源 | 是否必填 |
|------|------|----------|----------|
| 我的包 | App名称 + Bundle ID + 账号 | app_removal_monitor 表 | ✅ |
| 今日新增 | 今日新增数据（待定指标） | 待确定 | ❓ |
| 昨日新增 | 昨日新增数据（待定指标） | 待确定 | ❓ |
| 包状态 | 我的包的状态（在架/下架/未知） + 最后检查时间 | app_removal_monitor 表 | ✅ |
| 目标包 | 目标包名称 + App ID | target_apps 表 | ⚠️ 可能为空 |
| 备注 | 关联关系备注（主竞品、次竞品等） | 关联表 | ❌ 可选 |
| 目标包状态 | 目标包的状态（在架/下架/未知） + 状态更新时间 | target_apps 表 | ⚠️ 关联后必填 |
| 操作 | 操作按钮组 | - | ✅ |

---

## 🔗 关联关系设计

### 关联规则
- **一个"我的包"**可以关联 **0个或1个目标包**
- **一个目标包**可以被关联到**多个"我的包"**（允许多对一）

**示例场景**：
```
我的包：奇智AI写作助手 → 目标包：完美抄抄君
我的包：奇智AI文案工具 → 目标包：完美抄抄君（同一个竞品）
我的包：智能翻译助手   → 未关联
```

### 关联操作流程

#### 1. 建立关联

```
用户点击 [关联] 按钮
    ↓
弹出"选择目标包"对话框
    ↓
搜索/选择目标包
    ↓
填写备注（可选）
    ↓
确认关联
    ↓
刷新列表，显示关联结果
```

**关联弹窗设计**：

```
┌─────────────────────────────────────────────┐
│  关联目标包                                   │
│  我的包：奇智AI写作助手                       │
├─────────────────────────────────────────────┤
│  [🔍 搜索目标包...]                          │
│                                               │
│  选择目标包：                                 │
│  ┌───────────────────────────────────────┐  │
│  │ ○ 完美抄抄君 (6756691631)             │  │
│  │   状态: ❌ 已下架 (12-20)              │  │
│  │                                        │  │
│  │ ○ AI Writer Pro (1234567890)          │  │
│  │   状态: ✅ 在架                        │  │
│  │                                        │  │
│  │ ○ Smart Writing (0987654321)          │  │
│  │   状态: ⚪ 未知                        │  │
│  │                                        │  │
│  │ ○ 无忧文案 (1122334455)               │  │
│  │   状态: ✅ 在架                        │  │
│  └───────────────────────────────────────┘  │
│                                               │
│  关系备注：[________________]                │
│  常用标签：[主竞品] [次竞品] [观察对象]       │
│                                               │
│  [取消]                          [确定关联]  │
└─────────────────────────────────────────────┘
```

#### 2. 解除关联

```
用户点击 [解除] 按钮
    ↓
弹出确认对话框：
"确定要解除关联吗？
  我的包：奇智AI写作助手
  目标包：完美抄抄君"
    ↓
用户确认
    ↓
删除关联关系
    ↓
刷新列表，目标包列显示 [未关联]
```

---

## 🎬 用户交互场景

### 场景1：查看关联对比
**用户故事**：我想一眼看到我的所有包和对应竞品的状态对比

**操作流程**：
1. 进入"下架监控"页面
2. 默认显示所有我的包（包括已关联和未关联的）
3. 用筛选器选择"仅已关联"，只看有竞品对比的包
4. 滚动列表查看状态对比

**预期结果**：
- 清晰看到每个包和竞品的状态对比
- 可以快速识别哪些竞品已下架
- 可以看到自己的包和竞品的状态趋势

---

### 场景2：建立新的关联
**用户故事**：我新上架了一个App，想关联一个主要竞品进行对比

**操作流程**：
1. 找到未关联的我的包
2. 点击 [关联] 按钮
3. 在弹窗中搜索竞品名称或 App ID
4. 选择目标竞品
5. 填写备注（如"主竞品"）
6. 确认关联

**预期结果**：
- 关联成功后，该行显示目标包信息
- 可以看到目标包的状态
- [关联] 按钮变为 [解除] 按钮

---

### 场景3：查看竞品详情
**用户故事**：我想深入了解某个竞品的关键词表现

**操作流程**：
1. 在已关联的行中
2. 点击 [关键词] 按钮
3. 跳转到目标包的关键词查询链接（新标签页）

**其他快捷操作**：
- 点击 [七麦]：跳转到七麦数据页
- 点击 [App Store]：跳转到 App Store 页面
- 点击 [刷新]：重新检查该对的状态

---

### 场景4：批量同步和检查
**用户故事**：每天早上我想同步所有数据并检查状态

**操作流程**：
1. 点击 [同步我的包] - 从明道云同步"我的包"列表
2. 点击 [同步目标包] - 从明道云同步"目标包"列表
3. 点击 [批量检查] - 检查所有包（我的包+目标包）的在架状态

**预期结果**：
- 数据保持最新
- 可以看到昨晚是否有包被下架
- 统计面板数字更新

---

## 📊 数据需求

### 核心数据实体

#### 1. 我的包（My Apps）
**来源**：
- Supabase: `app_removal_monitor` 表
- 明道云: "账号上的产品" 工作表（`643418197f0301fb51750f00`）

**关键字段**：
- App 名称（`64341ac46d6df8983a7f7af3`）
- Bundle ID（`64b3a82fa75368cd24c99d8d`）
- App ID（`643418197f0301fb51750f02`）
- 开发者账号（`64341940fa601169896433f6`）
- App 状态（`64366ef856462b8747391a08`）
- 当前状态（在架/下架/未知）
- 最后检查时间
- 下架时间（如果下架）

#### 2. 目标包（Target Apps）
**来源**：
- Supabase: `target_apps` 表
- 明道云: "目标包" 工作表（`6436b372ca1784f12b3a4a91`）

**关键字段**：
- App 名称（`6436b372ca1784f12b3a4a92`）
- App ID（`6436b372ca1784f12b3a4a93`）
- 备注（`64c4c4595920ec871dff8051`）
- 当前状态（在架/下架/未知）
- 是否下架
- 下架日期
- 七麦链接
- 关键词查询链接
- App Store 链接

#### 3. 关联关系（Relations）
**重要发现**：关联关系已经存在于明道云中！

**来源**：明道云 "账号上的产品" 工作表中的字段
- **目标包字段**（ID: `65212229242cc1957d68f06a`）
  - 类型：Relation（关联字段）
  - 关联到："目标包" 工作表
  - 关系：一对一（subType=1）
  - 数据格式：
    ```json
    [{
      "sid": "目标包记录ID",
      "name": "目标包名称",
      "link": "跳转链接",
      "Index": 0
    }]
    ```

- **目标包名称字段**（ID: `68a270a3525f8dd536db3da3`）
  - 类型：Lookup（查找字段）
  - 从"目标包"字段查找目标包名称

- **目标包备注字段**（ID: `662f445897112d190139297b`）
  - 类型：Lookup（查找字段）
  - 从"目标包"字段查找目标包备注

**数据示例**：
```
我的包：生物种ּ子ֹֹ呀 (6756944462)
  ↓ 关联
目标包：生物种子呀 (6756721750)
备注：应用榜 440
```

**关键发现**：
✅ 不需要创建新的关联表！
✅ 关联关系已经在明道云中维护
✅ 我们只需要从明道云同步这些关联关系到 Supabase

---

## ✅ 字段可用性确认

### Demo 表格列字段

| 列名 | 数据来源 | 字段ID/表名 | 状态 | 备注 |
|------|----------|------------|------|------|
| **我的包 - App名称** | 明道云 | `64341ac46d6df8983a7f7af3` | ✅ 可用 | |
| **我的包 - Bundle ID** | 明道云 | `64b3a82fa75368cd24c99d8d` | ✅ 可用 | |
| **我的包 - App ID** | 明道云 | `643418197f0301fb51750f02` | ✅ 可用 | |
| **我的包 - 账号** | 明道云 | `64369d9b05108c17907e6a00` | ✅ 可用 | 返回开发者账号邮箱 |
| **Umeng ID** | 明道云 | `6438f8a907592fev2a98a1a6` | ✅ 可用 | 用于调用友盟API |
| **友盟数据链接** | 明道云 | `6565befa8815ce3493f25907` | ✅ 可用 | 自动生成的友盟趋势链接 |
| **今日新增** | 友盟 API | 通过Umeng ID获取 | ⏳ 待实现 | 需要友盟API配置 |
| **昨日新增** | 友盟 API | 通过Umeng ID获取 | ⏳ 待实现 | 需要友盟API配置 |
| ~~**累计用户**~~ | ~~明道云~~ | ~~`65863a39d81b5dfc766d0f19`~~ | ❌ 不需要 | 不显示此字段 |
| **包状态（我的包）** | 明道云 | `64366ef856462b8747391a08` | ✅ 可用 | 返回选项Key数组 |
| **包状态 - 最后检查时间** | Supabase | `app_removal_monitor.last_checked` | ✅ 可用 | |
| **目标包 - 关联** | 明道云 | `65212229242cc1957d68f06a` | ✅ 可用 | Relation字段 |
| **目标包 - 名称** | 明道云 | `68a270a3525f8dd536db3da3` | ✅ 可用 | Lookup字段 |
| **目标包 - 备注** | 明道云 | `662f445897112d190139297b` | ✅ 可用 | Lookup字段 |
| **目标包状态** | Supabase | `target_apps.is_offline` | ✅ 可用 | |
| **目标包 - 下架时间** | Supabase | `target_apps.offline_date` | ✅ 可用 | |
| **关键词查询链接** | 明道云 | `650b048db57c0312e55e7a4c` | ✅ 可用 | 自动生成的七麦搜索链接 |
| **七麦链接** | 明道云 | `65388cadea09c5df35ec81c6` | ✅ 可用 | 自动生成的七麦app页面 |
| **AppStore链接** | 明道云 | `6548da8c922ec33c68c13224` | ✅ 可用 | 自动生成的AppStore链接 |

### 数据可用性结论

✅ **完全可用 - 可立即实现**（18个字段）：
- 我的包基本信息（名称、Bundle ID、App ID、账号）
- 我的包状态和最后检查时间
- 目标包关联信息（关联、名称、备注）
- 目标包状态和下架时间
- 所有操作链接（关键词、七麦、AppStore、友盟数据）
- Umeng ID（用于后续API调用）

⏳ **待实现 - 需要友盟API配置**（2个字段）：
- 今日新增（通过Umeng ID从友盟API获取）
- 昨日新增（通过Umeng ID从友盟API获取）

❌ **不需要**（1个字段）：
- 累计用户

---

## ✅ 已确认需求

### 友盟API集成 - 今日/昨日新增数据

**需求确认**：
- **今日新增**和**昨日新增**两个字段需要从友盟API获取
- 通过 **Umeng ID** 字段（`6438f8a907592fef2a98a1a6`）调用友盟API
- **友盟API配置已有**：
  - API Key: `1769970`
  - API Security: `4GIR6sHLUftD`
  - 基础URL: `https://gateway.open.umeng.com/openapi/`

**友盟API技术要点**：

1. **签名认证机制**：
   - 算法：`MD5(urlPath + sorted_params + apiSecurity).toUpperCase()`
   - 参数需要按key排序后拼接
   - 签名结果转大写

2. **获取今日新增数据**：
   - 接口：`umeng.uapp.getTodayData`
   - 参数：`appkey={umeng_id}`
   - 返回：`todayData.newUsers`（今日新增用户数）

3. **获取昨日新增数据**：
   - 接口：`umeng.uapp.getYesterdayData`
   - 参数：`appkey={umeng_id}`
   - 返回：`yesterdayData.newUsers`（昨日新增用户数）

4. **批量获取优化**：
   - 支持批量并发请求（建议每批10个）
   - 批次间延迟100ms，避免请求过快
   - 需要错误处理（某些App可能无数据）

**数据关联流程**：
```
明道云（账号上的产品）
  ↓ 获取 Umeng ID（6438f8a907592fef2a98a1a6）
友盟API
  ↓ 调用 getTodayData + getYesterdayData
  ↓ 返回 newUsers 数据
Supabase / 前端展示
  ↓ 显示今日新增 / 昨日新增
```

**实现策略**：
- **MVP阶段（阶段1）**：
  - 先实现其他18个字段的完整功能
  - 今日/昨日新增字段显示占位符 "-"
  - 预留字段位置和数据结构
  
- **友盟集成阶段（阶段2）**：
  - ✅ 友盟API配置已有（无需额外配置）
  - 实现友盟签名算法
  - 实现批量数据获取服务
  - 添加数据缓存机制（避免频繁调用）
  - 填充"今日新增"和"昨日新增"字段

**参考文档**：
- 详细实现方案见：`友盟ID关联明道云应用展示技术实现方案.md`
- 包含完整的代码示例和签名算法

---

## ✅ 高优先级需求确认

### 1. 关联关系管理
**决策**：完全在明道云中管理
- ✅ 新界面**不提供**建立/解除关联功能
- ✅ 新界面**只读取展示**关联关系
- ✅ 用户需要修改关联，去明道云操作
- ❌ 不需要 [关联] / [解除] 按钮

### 2. 数据同步策略
**决策**：沿用现有"下架监控"模块的策略，并扩展支持目标包

**现有策略（下架监控）**：
- 🔄 后端定时任务：每12小时自动检查一次
- 👆 用户手动触发：
  - "同步我的包" 按钮 → 从明道云同步
  - "批量检查" 按钮 → 检查所有包状态
  - "刷新" 按钮（单个） → 检查单个包状态
- 📄 页面加载：自动加载数据（不触发同步）

**新策略（升级后）**：
- 🔄 后端定时任务：
  - 每12小时检查"我的包"状态
  - 每1小时检查"目标包"状态（已有，来自目标包监控）
- 👆 用户手动触发：
  - "同步我的包" 按钮 → 从明道云同步"账号上的产品"（含关联关系）
  - "同步目标包" 按钮 → 从明道云同步"目标包"
  - "批量检查" 按钮 → 同时检查所有"我的包"和"目标包"状态
  - "刷新" 按钮（单个行） → 检查该行的"我的包"和"目标包"（如果有关联）状态
- 📄 页面加载：自动加载Supabase中的数据

**同步哪些数据**：
- ✅ "我的包"：从明道云"账号上的产品"表同步（含Umeng ID、关联关系）
- ✅ "目标包"：从明道云"目标包"表同步
- ✅ 关联关系：从"账号上的产品"表的"目标包"字段读取

### 3. [刷新] 按钮行为
**决策**：选项C - 刷新所有数据（包括友盟数据）

**刷新内容（按阶段）**：

**阶段1（MVP）**：
- ✅ 检查"我的包"状态（iTunes API + App Store Connect API）
- ✅ 检查"目标包"状态（iTunes API）- 如果有关联
- ✅ 更新最后检查时间
- ⏸️ 友盟数据（暂不刷新，显示 "-"）

**阶段2（友盟集成后）**：
- ✅ 检查"我的包"状态
- ✅ 检查"目标包"状态
- ✅ 调用友盟API获取今日/昨日新增数据（基于Umeng ID）
- ✅ 更新所有数据

**技术实现**：
```typescript
// 单行刷新逻辑
async function refreshRow(myAppBundleId: string, targetAppId?: string) {
  // 1. 检查我的包状态
  const myAppStatus = await checkMyAppStatus(myAppBundleId);
  
  // 2. 检查目标包状态（如果有关联）
  let targetAppStatus = null;
  if (targetAppId) {
    targetAppStatus = await checkTargetAppStatus(targetAppId);
  }
  
  // 3. 获取友盟数据（阶段2）
  // const umengData = await getUmengData(umengId);
  
  // 4. 更新数据库和界面
  await updateDatabase({ myAppStatus, targetAppStatus });
}
```

### 4. [关联] / [解除] 按钮
**决策**：不需要
- ❌ 关联关系在明道云管理，新界面不提供这些操作
- ✅ 只显示关联状态和关联信息

---

## ✅ 中优先级需求确认

**决策**：全部沿用现有"下架监控"模块的实现

### 1. 搜索功能
**沿用现有实现**：
- 搜索字段：App名称、Bundle ID、开发者账号
- 实时搜索（输入即搜索）
- 不区分大小写

**扩展（新增）**：
- + 目标包名称
- + 目标包备注

### 2. 筛选器
**沿用现有实现**：
- 状态筛选：
  - 全部
  - 在架（AVAILABLE）
  - 下架（REMOVED）
  - 未知（UNKNOWN）

**扩展（新增）**：
- 显示模式筛选：
  - 全部（所有我的包）
  - 仅已关联（有目标包的）
  - 仅未关联（没有目标包的）

### 3. 排序
**沿用现有实现**：
- 默认排序：最后检查时间降序（最近检查的在前）
- 支持手动排序（可选）

### 4. 分页
**沿用现有实现**：
- 每页显示：20条（与现有保持一致）
- 支持上一页/下一页
- 显示总数和当前范围

---

## ✅ 低优先级需求确认

### 1. 统计面板数据来源
**决策**：实时计算
- 每次查询时从数据中统计
- 不使用缓存
- 保证数据准确性

**统计指标（6个）**：
```
我的包总数 = count(所有我的包)
我的包在架 = count(状态=AVAILABLE)
我的包下架 = count(状态=REMOVED)
已关联数   = count(有目标包关联的我的包)
目标包在架 = count(关联的目标包状态=available)
目标包下架 = count(关联的目标包状态=removed)
```

### 2. 批量操作
**决策**：支持批量操作
- ✅ "批量检查" 按钮：检查所有包（我的包+目标包）
- ✅ 显示进度和状态
- ✅ 错误处理（某些包检查失败不影响其他包）

**不支持的批量操作**（暂不实现）：
- ❌ 批量勾选多个包进行操作
- ❌ 批量导出
- ❌ 批量删除

### 3. 权限控制
**决策**：暂时不加
- 所有用户都可以执行同步、刷新操作
- 后续如有需要再添加

---

## ❓ 待确认问题（可选功能）

### 🟢 可选功能

---

#### 功能1：历史趋势视图
**场景**：查看某个对比关系的历史变化趋势

**功能描述**：
- 点击某一行，弹出详情页
- 显示近30天的状态变化曲线
- 对比"我的包"和"目标包"的状态变化

**实现时机**：后续根据需求再定

---

#### 功能2：通知提醒
**场景**：重要状态变化时发送通知

**功能描述**：
- 目标包下架 → 通知
- 我的包下架 → 紧急通知
- 支持多种通知方式（邮件、微信、站内消息）

**实现时机**：后续根据需求再定

---

#### 功能3：关联推荐
**场景**：系统自动推荐可能的竞品

**功能描述**：
- 基于 App 名称相似度
- 基于分类相似度
- 基于关键词重叠度

**实现时机**：后续根据需求再定

---

## 🎯 成功标准

### 用户体验目标
- ✅ 用户可以在一个页面完成所有对比查看操作
- ✅ 从进入页面到找到目标对比信息，不超过3次点击
- ✅ 关联操作简单直观，不需要培训即可使用

### 功能完整性目标
- ✅ 支持查看所有"我的包"和对应的目标包
- ✅ 支持建立/解除关联关系
- ✅ 支持快速跳转到竞品分析工具
- ✅ 支持筛选和搜索

### 性能目标
- ✅ 页面首次加载时间 < 2秒
- ✅ 关联操作响应时间 < 1秒
- ✅ 批量检查支持至少100个包的并发检查

---

## 📝 需求讨论记录

### 讨论1：关联关系（2025-12-25）
**结论**：确定为一对一或一对零的关系
- 一个"我的包"只能关联0个或1个目标包
- 简化了界面复杂度
- 满足当前业务需求

### 讨论2：待补充
（后续讨论记录将在这里添加）

---

## 📅 开发计划（初步）

### 阶段1：MVP - 核心对比功能（优先）
**目标**：实现基本的"我的包 vs 目标包"对比视图

- [ ] 从明道云同步"我的包"数据（含关联关系）
- [ ] 从明道云同步"目标包"数据
- [ ] 从Supabase读取包状态数据
- [ ] 实现关联对比列表（表格视图）
- [ ] 实现筛选和搜索功能
- [ ] 实现统计面板（6个指标）
- [ ] 操作按钮：刷新、关键词、七麦、AppStore
- [ ] **今日/昨日新增字段显示占位符 "-"**

**完成标准**：
- ✅ 可以看到所有我的包和对应目标包的状态对比
- ✅ 可以筛选（全部/已关联/未关联）
- ✅ 可以搜索
- ✅ 可以刷新单个包的状态

---

### 阶段2：友盟集成 - 今日/昨日新增数据
**目标**：集成友盟API，显示真实的新增用户数据

**前置条件**：
- ⏳ 友盟API访问权限配置完成
- ⏳ 友盟API文档研究完成

**开发任务**：
- [ ] 配置友盟API密钥
- [ ] 实现友盟API调用服务
- [ ] 获取"今日新增"数据
- [ ] 获取"昨日新增"数据
- [ ] 更新前端显示（替换占位符）
- [ ] 添加数据缓存机制（避免频繁调用友盟API）

**完成标准**：
- ✅ 今日/昨日新增字段显示真实数据
- ✅ 数据更新及时（建议每天凌晨自动更新）

---

### 阶段3：高级功能（可选）
- [ ] 历史趋势视图
- [ ] 通知提醒
- [ ] 批量操作优化
- [ ] 关联推荐

---

## 📋 需求总结（开发参考）

### 核心功能清单

✅ **MVP阶段（必须实现）**：

**数据同步**：
- [ ] 从明道云同步"我的包"（含关联关系、Umeng ID）
- [ ] 从明道云同步"目标包"
- [ ] 从Supabase读取状态数据
- [ ] 支持手动触发同步（两个独立按钮）

**界面展示**：
- [ ] 表格式对比视图（每行一个"我的包" + 对应的"目标包"）
- [ ] 显示18个可用字段（今日/昨日新增显示 "-"）
- [ ] 统计面板（6个指标，实时计算）
- [ ] 搜索功能（App名称、Bundle ID、账号、目标包名称、备注）
- [ ] 筛选器（状态筛选 + 显示模式筛选）
- [ ] 分页（每页20条）

**状态检查**：
- [ ] 单行刷新（检查我的包+目标包状态）
- [ ] 批量检查（检查所有包）
- [ ] 显示最后检查时间
- [ ] 错误处理

**操作链接**：
- [ ] 关键词查询链接
- [ ] 七麦链接
- [ ] AppStore链接
- [ ] 友盟数据链接

---

⏳ **阶段2 - 友盟集成（后续实现）**：
- [ ] 配置友盟API客户端（签名算法）
- [ ] 实现今日新增数据获取
- [ ] 实现昨日新增数据获取
- [ ] 批量并发请求优化
- [ ] 数据缓存机制
- [ ] 刷新时更新友盟数据
- [ ] 前端显示真实数据（替换 "-"）

---

🎨 **可选功能（按需实现）**：
- [ ] 历史趋势视图
- [ ] 通知提醒
- [ ] 关联推荐

---

### 技术要点

**数据关联关键字段**：
| 字段 | ID | 用途 |
|------|----|----|
| App名称 | `64341ac46d6df8983a7f7af3` | 显示 |
| Bundle ID | `64b3a82fa75368cd24c99d8d` | 唯一标识 |
| App ID | `643418197f0301fb51750f02` | iTunes API |
| Umeng ID | `6438f8a907592fef2a98a1a6` | 友盟API |
| 目标包关联 | `65212229242cc1957d68f06a` | 关联关系 |

**API调用**：
- iTunes API：检查包状态
- App Store Connect API：检查包状态（备用）
- 明道云API：同步数据
- 友盟API：获取统计数据（阶段2）

**定时任务**：
- 我的包：每12小时检查一次
- 目标包：每1小时检查一次

---

## 附录

### 相关文档
- [PRD 4.0 - 目标包监控功能](./PRD4.0.md)
- [PRD 3.0 - 下架监控功能](./PRD.md)
- [友盟ID关联明道云应用展示技术实现方案](./友盟ID关联明道云应用展示技术实现方案.md)

### 更新历史
- 2025-12-25：创建文档，完成需求讨论，确认所有优先级需求

